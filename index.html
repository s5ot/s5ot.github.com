
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>s5ot.send(:blog)</title>
	<meta name="author" content="s5ot">

	
	<meta name="description" content="AngularJSの練習をしていたら作業用BGM再生アプリができました。 ナガレテッター どういうものか J-WAVEで流れた曲がプレイリストになっています。
プレイリストから曲をクリックすると、YouTubeにあるその曲の動画が流れます。 なぜ作ったか AngularJSの勉強のため。 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="s5ot.send(:blog)" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
  <header id="header" class="inner"><h1><a href="/">s5ot.send(:blog)</a></h1>
<nav id="main-nav"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</nav>
<nav id="mobile-nav">
  <div class="alignleft menu">
    <a class="button">Menu</a>
    <div class="container"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</div>
  </div>
  <div class="alignright search">
    <a class="button"></a>
    <div class="container">
      <form action="http://google.com/search" method="get">
        <input type="text" name="q" results="0">
        <input type="hidden" name="q" value="site:s5ot.github.io">
      </form>
    </div>
  </div>
</nav>
<nav id="sub-nav" class="alignright">
  <div class="social">
    
    
    <!--
    
    <a class="twitter" href="http://twitter.com/s5ot" title="Twitter">Twitter</a>
    
    
    <a class="github" href="https://github.com/s5ot" title="GitHub">GitHub</a>
    
    -->
    
    
    
    
    
    
    <a class="rss" href="/atom.xml" title="RSS">RSS</a>
    
  </div>
  <form class="search" action="http://google.com/search" method="get">
    <input class="alignright" type="text" name="q" results="0">
    <input type="hidden" name="q" value="site:s5ot.github.io">
  </form>
</nav>

</header>
  
  
  <div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/03/11/angular-app/">
		
			AngularJSで作業用BGM再生アプリを作りました</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://s5ot.github.io/nagaretetter-client/"><img src="/images/2014-03-11-angularjs-app/angularjs-app.png"></a></p>

<p>AngularJSの練習をしていたら作業用BGM再生アプリができました。 <br/>
<a href="http://s5ot.github.io/nagaretetter-client/">ナガレテッター</a></p>

<h3>どういうものか</h3>

<p>J-WAVEで流れた曲がプレイリストになっています。<br/>
プレイリストから曲をクリックすると、YouTubeにあるその曲の動画が流れます。</p>

<h3>なぜ作ったか</h3>

<p>AngularJSの勉強のため。<br/>
新しい曲・名曲を知るきっかけになるのがラジオであることが多いです（個人的に）。なのでそのきっかけが広がるものを作りたいと思ったため。</p>

<h3>仕組みは</h3>

<p>HerokuのClock ProcessでJ-WAVEで流れた曲を取ってきて定期的にMongoDB（MongoLab）に保存しています。<br/>
さらにHerokuにRailsでAPIサーバーを立てて、MongoDBのデータを返します。<br/>
クライアントはYeomanのgenerator-angularを元にして作りました。これをGitHub Pagesにデプロイしてます。<br/>
YouTube再生の内部的な仕組みはyusukebeさん作の<a href="http://yusukebe.github.io/FMTube/">FMTube</a>の実装を参考にさせてもらいました。勉強になります。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-11T15:40:00+09:00" pubdate data-updated="true">Mar 11<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/03/11/angular-app//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/28/angularjs-infinite-scroll/">
		
			AngularJSで無限スクロール</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-02-28-infinite-scroll/infinite.png"></p>

<p>こんにちは。今日は暖かい日和です。もう3月ですね。</p>

<p>さて、放置気味だったAngularJSの勉強を再開しました。
とりあえずこの本を読んでいます。<br/>
良い本と思います。</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=httpdhaten036-22&o=9&p=8&l=as1&asins=B00EQ67J30&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>さて、Twitterのタイムラインのような無限スクロールをAngularJSで作るとどういう感じになるのかな、ということを調べてみました。</p>

<p>ググってみると、ズバリなものが見つかります。<br/>
<a href="http://binarymuse.github.io/ngInfiniteScroll/">ngInfiniteScroll</a><br/>
これでええやん、という話ですが、今回はもっと軽い実装を探してみます。</p>

<p>そうすると、こういうものがJSFiddleにアップされています。<br/>
<a href="http://jsfiddle.net/vojtajina/U7Bz9/">AngularJS: Infinite Scrolling</a><br/>
なるほど、AngularJSではコレクションのレンダリングは自動でやってくれるので、一番下までスクロールしたタイミングでコレクションにデータを追加してやれば簡単にできるようです。</p>

<p>これを参考にして実装してみました。</p>

<h3>Template</h3>

<p>無限スクロールを表示する部分です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&#39;content&#39;</span> <span class="na">when-scrolled=</span><span class="s">&#39;loadMore()&#39;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;ul</span> <span class="na">ng-repeat=</span><span class="s">&#39;d in data&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;</span>{{d}}<span class="nt">&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>dataという名前のコレクションをリスト表示しています。
リストを囲っているdivにwhen-scrolledというディレクティブを指定しています。</p>

<h3>Directive</h3>

<p>whenScrolledディレクティブです。<br/>
一番下までスクロールしたらattributeの値を実行するようにします。<br/>
つまりコントローラーのloadMoreを実行します。</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp.directives&#39;</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'>  <span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;appVersion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">elm</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">version</span><span class="p">);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">}])</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;whenScrolled&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span>  <span class="nx">elem</span><span class="p">,</span>  <span class="nx">attr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">$window</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span>  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">raw</span><span class="p">.</span><span class="nx">offsetTop</span> <span class="o">+</span> <span class="nx">raw</span><span class="p">.</span><span class="nx">offsetHeight</span> <span class="o">&lt;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">scope</span><span class="p">.</span><span class="nx">$apply</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">whenScrolled</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Controller</h3>

<p>コントローラーはInfiniteScrollCtrlです。<br/>
初期時には25個の要素をdataに入れます。<br/>
loadMoreメソッドがコールされると、dataに25個追加します。<br/>
これにより無限スクロールするように見えます。</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp.controllers&#39;</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'>  <span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MyCtrl1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}])</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MyCtrl2&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}])</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;InfiniteScrollCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$scope&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">loadMore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">next</span> <span class="o">===</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">25</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>まとめ</h3>

<p>データを増やせば自動でレンダリングされるので、jQueryなどで実装するよりコード量が減りますね。<br/>
<a href="https://github.com/s5ot/angular-seed/tree/infinite-scroll">ここ</a>に実装おいてます。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-28T15:08:00+09:00" pubdate data-updated="true">Feb 28<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/02/28/angularjs-infinite-scroll//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/13/flot/">
		
			Flotでグラフを書いてみる</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-02-13-flot/flot.jpg"></p>

<p>データビジュアライゼーションが気になる今日この頃です。</p>

<p><a href="http://wazanova.jp/items/881">D3.jsでグラフを描いてみる</a>
を読んだのですが、割とシンプルなグラフなのにけっこう面倒くさいと感じました。<br/>
まあD3.jsがグラフに特化してるわけでないからと思います。</p>

<p>人気のKibanaを見たところ、グラフはjQueryベースのFlotで書いているようです。<br/>
<a href="https://github.com/elasticsearch/kibana">elasticsearch / kibana</a><br/>
というわけで、Flotを試してみようと思いました。</p>

<p><a href="http://www.flotcharts.org/">Flot</a></p>

<p>Examplesにあるこれを参考にしました。<br/>
<a href="http://www.flotcharts.org/flot/examples/categories/index.html">Categories</a></p>

<p>それっぽいものはすぐにできたのですが、<br/>
<a href="https://gist.github.com/s5ot/8970149">s5ot / gist:8970149</a><br/>
どうもFlotにはd3 transition APIのようなアニメーション向けのAPIがないようにお見受けしました。<br/>
ちょっとそれをゴリゴリ書くのはキツいですね。。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-13T14:20:00+09:00" pubdate data-updated="true">Feb 13<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/02/13/flot//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/28/rubymotion-with-ib/">
		
			RubyMotionアプリでStoryboardを使う（ibを使う）</a>
	</h2>
	<div class="entry-content">
		<iframe src="http://www.flickr.com/photos/47747551@N00/1752001425/in/photolist-3EPsZ8-3K7dF1-49iLB9-4cWUj2-4f6VEo-4hA4yi-4o7GQm-4spNRh-4ATm9o-4CXsqK-4EdxML-4EdxP7-4EdxRC-4RmW3A-4RNNsB-4Stia8-59s7rC-5prazq-5zUybw-5KEpP7-5NQBRu-5SaBAo-5Ze7jL-5ZHv4K-64Nkmy-6a1nCW-6c7Ls9-6j7f45-6jiJyZ-6nEjbB-6nEjci-6nJtLU-6ytjij-6D6Hcy-6WZHcE-72JMGN-79vfT8-7fpFMQ-7jiqAP-7jxPWt-7jGFTD-7k68h4-7kVDtr-7rpxQC-7YtEDK-ddfofL-85yf3Z-aBhkHC-agPLKu-agPLHh-8JKoZv/player/" width="500" height="375" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>


<p>以前にRubyMotionでStoryboardを使う方法を調べたことがありました。</p>

<p><a href="http://s5ot.github.io/blog/2013/12/13/rubymotion-with-storyboard/">RubyMotionアプリでStoryboardを使うには</a></p>

<p>まあ使えることは使えたんですが、Storyboardとヘッダファイルの結びつけとかできなくて、あまり実用的でないなあ。。という感じでした。<br/>
最近になって、そういうモヤっとしたところを解決してくれるgemがあることをこちらで知りました。</p>

<p><a href="http://mobiletou.ch/2013/12/%E7%AC%AC%E5%85%AB%E5%9B%9E-rubymotion-%E3%81%A7-interface-builder-%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AB%E3%81%AF%EF%BC%9F">第八回 RubyMotion で Interface Builder を使うには？</a></p>

<p>ということで、こちらで紹介されているibを使ってみました。</p>

<p>ibをインストール後、rake ib:project タスクを実行すると、Storyboard用のXcodeプロジェクトが作成されます。<br/>
そして rake ib:open タスクを実行すると、Xcodeが起動してStoryboardが表示されます。<br/>
このときに、ibがRubyMotionで実装したOutletやメソッドを自動でStubs.hファイルに展開してくれます。<br/>
Outletはoutletクラスメソッドで宣言的に書きます。（下記参照）<br/>
メソッドはIBActionになります。</p>

<p>具体的には、このように書いておいて rake ib:open を実行すると、</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">NewPostViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">IB</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:addressLabel</span><span class="p">,</span> <span class="no">UILabel</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:detailTextView</span><span class="p">,</span> <span class="no">UITextView</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:tagTextField</span><span class="p">,</span> <span class="no">UITextField</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:scrollView</span><span class="p">,</span> <span class="no">UIScrollView</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:uploadButton</span><span class="p">,</span> <span class="no">UIBarButtonItem</span>
</span><span class='line'>  <span class="n">outlet</span> <span class="ss">:manholeImageView</span><span class="p">,</span> <span class="no">UIImageView</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">onSingleTap</span>
</span><span class='line'>    <span class="sr">//</span> <span class="no">Do</span> <span class="n">something</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="sr">//</span> <span class="n">snip</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Stubs.hにはこんな感じで展開されるわけです。</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">@</span><span class="n">interface</span> <span class="n">NewPostViewController</span><span class="o">:</span> <span class="n">UIViewController</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span> <span class="n">addressLabel</span><span class="p">;</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UITextView</span> <span class="o">*</span> <span class="n">detailTextView</span><span class="p">;</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UITextField</span> <span class="o">*</span> <span class="n">tagTextField</span><span class="p">;</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UIScrollView</span> <span class="o">*</span> <span class="n">scrollView</span><span class="p">;</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UIBarButtonItem</span> <span class="o">*</span> <span class="n">uploadButton</span><span class="p">;</span>
</span><span class='line'><span class="err">@</span><span class="n">property</span> <span class="n">IBOutlet</span> <span class="n">UIImageView</span> <span class="o">*</span> <span class="n">manholeImageView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="p">(</span><span class="n">IBAction</span><span class="p">)</span> <span class="n">onSingleTap</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>あとはStoryboardからStubs.hにビーッと線を伸ばして紐付けをしてあければよいわけです。<br/>
やっぱりStoryboardを使うとビューのコードがググっと減るので便利ですね。全体構成もつかみやすくなるし。<br/>
これからはibを使っていこうと思ってます。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-28T15:01:00+09:00" pubdate data-updated="true">Jan 28<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/01/28/rubymotion-with-ib//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/16/clock-process/">
		
			Herokuで定期処理(Clock Process)</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-01-16-clock/clock.jpg"></p>

<p>ちょっとした定期処理をやりたい事案が発生しました。できればお金をかけずにやりたい。<br/>
ということでここはHerokuでなんとかできないか調べてみたところ、Clock Processというのが期待どおりな感じでした。
<a href="https://devcenter.heroku.com/articles/clock-processes-ruby">Scheduled Jobs and Custom Clock Processes in Ruby with Clockwork</a></p>

<p>clockworkというgemを使って定期処理を書いて、Herokuで常駐プロセスが定期処理を実行してくれるというものです。
<a href="https://github.com/tomykaira/clockwork">tomykaira / clockwork</a><br/>
また、clockworkを使うHerokuアプリのひな形を作ってくれるシェルスクリプトがあったりしてありがたい感じです。<br/>
<a href="https://gist.github.com/tomykaira/1312172">tomykaira / clockwork-init.sh</a><br/>
clockworkはシンプルなAPIでやりたいことをすぐに書ける感じになってますが、かなり高機能でもあるようです。こちらが詳しいです。<br/>
<a href="http://www.ownway.info/Ruby/index.php?clockwork%2Fabout">clockwork について</a></p>

<p>ということで、ちょっとした定期処理を書くならHerokuのClock Processが便利という話でした。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-16T23:13:00+09:00" pubdate data-updated="true">Jan 16<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/01/16/clock-process//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/14/ibeacon/">
		
			アプリックスのBM1でiBeaconを試す</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-01-14-bm1/bm1.png"></p>

<p>アプリックスのBeaconモジュール「BM1」を入手したので（お借りしたので）、試しています。</p>

<p>BM1にはBeaconのデータを書き換えることができるアプリが提供されていて、このアプリからproximityUUID, major, minor, measured powerを書き換えることができます。<br/>
<img src="/images/2014-01-14-bm1/bm1setup.png"></p>

<p>BM1からの電波を受信するアプリを作ってみました。<br/>
<a href="https://github.com/s5ot/BM1Receiver">BM1Receiver</a></p>

<p>参考にさせてもらったのはこちらです。     <br/>
<a href="https://github.com/suwa-yuki/BeaconSample">BeaconSample</a></p>

<p><img src="/images/2014-01-14-bm1/bm1receiver.png"></p>

<p>Beaconの領域に入ったり出たりしたときにLocal Notificationを出したりします。<br/>
<img src="/images/2014-01-14-bm1/bm1receiver_notification.png"></p>

<h3>思ったこと</h3>

<p>複数のBM1を運用するケースで、ProximityUUIDをアプリ経由で書き換えるのは手間がかかる。一括で管理するアプリがあると便利かも。。出荷時にアプリックスに一括設定を頼むことはできるみたい。あ、別途提供予定らしいですね。</p>

<p>BM1で使えるProximityUUIDはどこから発行されているのだろう？<br/>
国際規格に基づいてアプリックス社で生成されているらしいのですが。。<br/>
もし同じUUIDが他で使われていた場合は損害賠償を求めることができるらしいです。</p>

<p>BM1設定アプリでmeasured powerを設定できるけども、これはCoreLocationのAPIでは取得できないもよう。CoreBluetoothのAPIからは取れると思うのだけれども。</p>

<p>BM1の電波を受信して動作するアプリがProximityUUIDをどうやって得るか。<br/>
サーバーに問い合わせる形になりますよね。<br/>
やっぱりサーバーサイドの管理アプリが必要ですよね。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-14T01:39:00+09:00" pubdate data-updated="true">Jan 14<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/01/14/ibeacon//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/04/rubymotion-with-testflight/">
		
			RubyMotionアプリでTestFlightを使ってみる</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-01-04-testflight/testflight.png">
前々からTestFlightを使ってみたいと思ってたのですがなかなかできてなかったのでとりあえずやってみました。</p>

<p>RubyMotionアプリでTestFlightを使うにあたっては、motion-testflightという便利なgemがあります。  これを素直に使わせてもらいます。 <br/>
<a href="https://github.com/HipByte/motion-testflight">motion-testflight</a></p>

<p>こちらを使うとRakeタスク「testflight」でビルドしたアプリをTestFlightへアップロードして配布することができます。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ bundle exec rake testflight notes="zomg!"</span></code></pre></td></tr></table></div></figure>


<p>このRakeタスクを実行するにはRakefileに3つのtokenを設定する必要があるのですが、それらをどこから得るのか分かりにくかったのでメモしておきます。</p>

<h3>api_token</h3>

<p><a href=https://testflightapp.com/account/#api>https://testflightapp.com/account/#api</a></p>

<h3>team_token</h3>

<p><a href=https://testflightapp.com/dashboard/team/edit/?next=/api/doc/>https://testflightapp.com/dashboard/team/edit/?next=/api/doc/</a></p>

<h3>app_token</h3>

<p>Appsタブからアプリを登録すると発行される</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-04T00:48:00+09:00" pubdate data-updated="true">Jan 4<span>th</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/01/04/rubymotion-with-testflight//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/02/apnssample/">
		
			iOSのAPNsを試してみた</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2014-01-02-apnssample/push.png"><br/>
あけましておめでとうございます。<br/>
Apple Push Notificationサービス（APNs）を自分で動かしたことがなかったので試してみました。</p>

<p>ggってみると、こちらがいろんなところからお手本として参照されているようです。<br/>
確かにとても親切な解説になっているので、これでAPNsをバッチリ試すことができました。<br/>
iOS6向けと書いてますが、iOS7でも特に違いはありません。<br/>
<a href="http://www.raywenderlich.com/32960/apple-push-notification-services-in-ios-6-tutorial-part-1">Apple Push Notification Services in iOS 6 Tutorial: Part 1/2</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-02T16:07:00+09:00" pubdate data-updated="true">Jan 2<span>nd</span>, 2014</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2014/01/02/apnssample//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/29/docker/">
		
			apache-loggen + Fluentd + Elasticsearch + Kibana3をVagrant with Dockerで動かしてみる</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2013-12-29-docker/kibana3.png">
この前、手元のMac OS X上にFluentd + Elasticsearch + Kibana3の環境を作ってみました。
けど、こういうのは仮想環境上に作っておくのがなにかと便利です。</p>

<p>Vagrantの最近のアップデートでprovisioningにDockerが使えるようになりました。
これはDocker使って環境作ったらかっこええんちゃう？と思ったら、すでにやっている方がいました。<br/>
<a href="http://blog.riywo.com/2013/12/14/155617">簡単！Vagrant+Docker+td-agent+Elasticsearch+Kibanaで流行に乗ろう</a></p>

<p>こちらを参考にDockerを触ってみて、Dockerの雰囲気と面白さがなんとなく感じられました。<br/>
ただ、Kibanaでいい感じの表示をするためにはある程度のデータがあったほうがいいので、apache-loggenでデータを自動生成するのも混ぜたいなと思いました。<br/>
そこでできあがったのがこちらになります。<br/>
<a href="https://github.com/s5ot/vagrant-docker-td-es-kibana-sample">s5ot / vagrant-docker-td-es-kibana-sample</a></p>

<p>vagrant upすればapache-loggenがデータを作り続け、Fluentd のtailで Elasticsearch へ流し続けてます。<br/>
http://localhost:5555 でご覧ください。
Kibanaの使い方の練習ができます。</p>

<h3>Dockerに関して湧いた疑問</h3>

<p>ImageをBuildして最後にミドルウェアなりを起動するときにENTRYPOINTで起動するケースと、CMDでrun.shを叩いて起動するタイプがある。
これはどういう使い分けなんかな？と思ったけど、マニュアルに書いてあった。<br/>
<a href="http://docs.docker.io/en/latest/use/builder/">Build Images (Dockerfile Reference)</a></p>

<p>コンテナの起動時にconfig的なデフォルト値を与えて起動したいなら、CMDでrun.shのようなものを使う。CMDはImageのBuild時には実行されない。固定のバイナリを叩いてコンテナを起動するならENTRYPOINTを使う。<br/>
というように理解しました。</p>

<h3>あとやりたいこと</h3>

<h4>Kibanaのアップデート</h4>

<p>Kibana3のイメージは<a href="https://github.com/arcus-io/docker-kibana">arcus/kibana</a>を使ってるのですが、これはKibana 3 milestone 2になってます。本家はもっと新しいのが出ていてかなり機能が変わってるようなのでアップデートしたいところ。</p>

<h4>apache-loggenコンテナ</h4>

<p>今のところ、apache-loggenはtd-agentコンテナに同居しているのですが、apache-loggenだけのコンテナを作り、td-agentとDockerのmount Volumes機能で連携するのがスマートだと考えています。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-29T16:23:00+09:00" pubdate data-updated="true">Dec 29<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/12/29/docker//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/19/kibana3/">
		
			Fluentd + Elasticsearch + Kibana3を動かしてみる</a>
	</h2>
	<div class="entry-content">
		<p>Elasticsearchすげーよ、なんでいままで使ってなかったんだろう！的なツイートを見かけて、おおこれは触っておかなければ、と思い立ちました。</p>

<p>ElasticsearchにRESTでデータを投げ込んで、それをKibana3で見てみましたが、なんだかピンとこなかったので、みんなどうしているのかなとggってみると、ApacheログをFluentdで読んでElasticsearchに投げてKibana3で見る、っていうのをみんなチュートリアル的にやってる感じなのでそれをやってみました。<br/>
参考にしたのはこちらです。<br/>
<a href="http://blog.johtani.info/blog/2013/06/10/fluent-es-kibana/">Apache-loggen + Fluentd + Elasticsearch + Kibana = ログ検索デモ</a></p>

<h3>Elasticsearchのインストール</h3>

<p>本家サイトからzipをダウンロードして解凍したディレクトリで</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ bin/elasticsearch -f</span></code></pre></td></tr></table></div></figure>


<p>で起動。
簡単です。</p>

<h3>Kibana3のインストール</h3>

<p>これまた本家サイトからzipをダウンロードして解凍したディレクトリをApacheのドキュメントルートに放り込めば動きます。<br/>
簡単です。</p>

<h3>Fluentdのインストール</h3>

<p>若干ハマりました。。 <br/>
Fluentdはいろいろとインストールの方法があるのですが、なんとなくbrewでインストールしてみました。<br/>
で、FluentdからElasticsearchへ連携するためにfluent-plugin-elasticsearchというFluentdのプラグインを使いますのでインストールします。<br/>
<a href="https://github.com/uken/fluent-plugin-elasticsearch">fluent-plugin-elasticsearch</a><br/>
そしてFluentdの設定を追加します。</p>

<figure class='code'><figcaption><span>td-agent.conf</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">source</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="n">type</span> <span class="n">tail</span>
</span><span class='line'>  <span class="nb">format</span> <span class="n">apache</span>
</span><span class='line'>  <span class="n">path</span> <span class="sr">/Applications/</span><span class="no">XAMPP</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">access_log</span>
</span><span class='line'>  <span class="n">tag</span> <span class="n">xampp</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">access</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/source&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;match *.apache.*&gt;</span>
</span><span class='line'><span class="sr">  index_name adminpack</span>
</span><span class='line'><span class="sr">  type_name apache</span>
</span><span class='line'><span class="sr">  type elasticsearch</span>
</span><span class='line'><span class="sr">  include_tag_key true</span>
</span><span class='line'><span class="sr">  tag_key @log_name</span>
</span><span class='line'><span class="sr">  host localhost</span>
</span><span class='line'><span class="sr">  port 9200</span>
</span><span class='line'><span class="sr">  logstash_format true</span>
</span><span class='line'><span class="sr">  flush_interval 10s</span>
</span><span class='line'><span class="sr">&lt;/m</span><span class="n">atch</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ td-agent</span></code></pre></td></tr></table></div></figure>


<p>で、td-agentを起動します。</p>

<p>これで準備はできたのですが、トラブル発生。
td-agentでエラーが発生しました。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>2013-12-18 17:05:29 +0900 [error]: config error file="/usr/local/etc/td-agent/td-agent.conf" error="Unknown output plugin 'elasticsearch'. Run 'gem search -rd fluent-plugin' to find plugins"</span></code></pre></td></tr></table></div></figure>


<p>elasticsearchのpluginが見つからないと。。インストールしたはずなのですが。</p>

<p>調べてみると、Fluentdは独自のGEM_HOMEを持っていて、そこにインストールしないとダメらしいです。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ /usr/local/bin/fluent-gem install fluent-plugin-elasticsearch</span></code></pre></td></tr></table></div></figure>


<p>これでtd-agentがpluginを見つけてくれました。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-19T14:18:00+09:00" pubdate data-updated="true">Dec 19<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/12/19/kibana3//index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
  <footer id="footer" class="inner">Copyright &copy; 2014

    s5ot

</footer>
  <script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 's5ot';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37441932-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
