
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>s5ot.send(:blog)</title>
	<meta name="author" content="s5ot">

	
	<meta name="description" content="この前、手元のMac OS X上にFluentd + Elasticsearch + Kibana3の環境を作ってみました。
けど、こういうのは仮想環境上に作っておくのがなにかと便利です。 Vagrantの最近のアップデートでprovisioningにDockerが使えるようになりました。 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="s5ot.send(:blog)" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
  <header id="header" class="inner"><h1><a href="/">s5ot.send(:blog)</a></h1>
<nav id="main-nav"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</nav>
<nav id="mobile-nav">
  <div class="alignleft menu">
    <a class="button">Menu</a>
    <div class="container"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</div>
  </div>
  <div class="alignright search">
    <a class="button"></a>
    <div class="container">
      <form action="http://google.com/search" method="get">
        <input type="text" name="q" results="0">
        <input type="hidden" name="q" value="site:s5ot.github.io">
      </form>
    </div>
  </div>
</nav>
<nav id="sub-nav" class="alignright">
  <div class="social">
    
    
    <!--
    
    <a class="twitter" href="http://twitter.com/s5ot" title="Twitter">Twitter</a>
    
    
    <a class="github" href="https://github.com/s5ot" title="GitHub">GitHub</a>
    
    -->
    
    
    
    
    
    
    <a class="rss" href="/atom.xml" title="RSS">RSS</a>
    
  </div>
  <form class="search" action="http://google.com/search" method="get">
    <input class="alignright" type="text" name="q" results="0">
    <input type="hidden" name="q" value="site:s5ot.github.io">
  </form>
</nav>

</header>
  
  
  <div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/29/docker/">
		
			apache-loggen + Fluentd + Elasticsearch + Kibana3をVagrant with Dockerで動かしてみる</a>
	</h2>
	<div class="entry-content">
		<p><img src="/images/2013-12-29-docker/kibana3.png">
この前、手元のMac OS X上にFluentd + Elasticsearch + Kibana3の環境を作ってみました。
けど、こういうのは仮想環境上に作っておくのがなにかと便利です。</p>

<p>Vagrantの最近のアップデートでprovisioningにDockerが使えるようになりました。
これはDocker使って環境作ったらかっこええんちゃう？と思ったら、すでにやっている方がいました。<br/>
<a href="http://blog.riywo.com/2013/12/14/155617">簡単！Vagrant+Docker+td-agent+Elasticsearch+Kibanaで流行に乗ろう</a></p>

<p>こちらを参考にDockerを触ってみて、Dockerの雰囲気と面白さがなんとなく感じられました。<br/>
ただ、Kibanaでいい感じの表示をするためにはある程度のデータがあったほうがいいので、apache-loggenでデータを自動生成するのも混ぜたいなと思いました。<br/>
そこでできあがったのがこちらになります。<br/>
<a href="https://github.com/s5ot/vagrant-docker-td-es-kibana-sample">vagrant-docker-td-es-kibana-sample</a></p>

<p>vagrant upすればapache-loggenがデータを作り続け、Fluentd のtailで Elasticsearch へ流し続けてます。<br/>
http://localhost:5555 でご覧ください。
Kibanaの使い方の練習ができます。</p>

<h3>Dockerに関して湧いた疑問</h3>

<p>ImageをBuildして最後にミドルウェアなりを起動するときにENTRYPOINTで起動するケースと、CMDでrun.shを叩いて起動するタイプがある。
これはどういう使い分けなんかな？と思ったけど、マニュアルに書いてあった。<br/>
<a href="http://docs.docker.io/en/latest/use/builder/">Build Images (Dockerfile Reference)</a></p>

<p>コンテナの起動時にconfig的なデフォルト値を与えて起動したいなら、CMDでrun.shのようなものを使う。CMDはImageのBuild時には実行されない。固定のバイナリを叩いてコンテナを起動するならENTRYPOINTを使う。<br/>
というように理解しました。</p>

<h3>あとやりたいこと</h3>

<h4>Kibanaのアップデート</h4>

<p>Kibana3のイメージは<a href="arcus/kibana">https://github.com/arcus-io/docker-kibana</a>を使ってるのですが、これはKibana 3 milestone 2になってます。本家はもっと新しいのが出ていてかなり機能が変わってるようなのでアップデートしたいところ。</p>

<h4>apache-loggenコンテナ</h4>

<p>今のところ、apache-loggenはtd-agentコンテナに同居しているのですが、apache-loggenだけのコンテナを作り、td-agentとDockerのmount Volumes機能で連携するのがスマートだと考えています。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-29T16:23:00+09:00" pubdate data-updated="true">Dec 29<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/12/29/docker//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/19/kibana3/">
		
			Fluentd + Elasticsearch + Kibana3を動かしてみる</a>
	</h2>
	<div class="entry-content">
		<p>Elasticsearchすげーよ、なんでいままで使ってなかったんだろう！的なツイートを見かけて、おおこれは触っておかなければ、と思い立ちました。</p>

<p>ElasticsearchにRESTでデータを投げ込んで、それをKibana3で見てみましたが、なんだかピンとこなかったので、みんなどうしているのかなとggってみると、ApacheログをFluentdで読んでElasticsearchに投げてKibana3で見る、っていうのをみんなチュートリアル的にやってる感じなのでそれをやってみました。<br/>
参考にしたのはこちらです。<br/>
<a href="http://blog.johtani.info/blog/2013/06/10/fluent-es-kibana/">Apache-loggen + Fluentd + Elasticsearch + Kibana = ログ検索デモ</a></p>

<h3>Elasticsearchのインストール</h3>

<p>本家サイトからzipをダウンロードして解凍したディレクトリで</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ bin/elasticsearch -f</span></code></pre></td></tr></table></div></figure>


<p>で起動。
簡単です。</p>

<h3>Kibana3のインストール</h3>

<p>これまた本家サイトからzipをダウンロードして解凍したディレクトリをApacheのドキュメントルートに放り込めば動きます。<br/>
簡単です。</p>

<h3>Fluentdのインストール</h3>

<p>若干ハマりました。。 <br/>
Fluentdはいろいろとインストールの方法があるのですが、なんとなくbrewでインストールしてみました。<br/>
で、FluentdからElasticsearchへ連携するためにfluent-plugin-elasticsearchというFluentdのプラグインを使いますのでインストールします。<br/>
<a href="https://github.com/uken/fluent-plugin-elasticsearch">fluent-plugin-elasticsearch</a><br/>
そしてFluentdの設定を追加します。</p>

<figure class='code'><figcaption><span>td-agent.conf</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">source</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="n">type</span> <span class="n">tail</span>
</span><span class='line'>  <span class="nb">format</span> <span class="n">apache</span>
</span><span class='line'>  <span class="n">path</span> <span class="sr">/Applications/</span><span class="no">XAMPP</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">access_log</span>
</span><span class='line'>  <span class="n">tag</span> <span class="n">xampp</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">access</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/source&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;match *.apache.*&gt;</span>
</span><span class='line'><span class="sr">  index_name adminpack</span>
</span><span class='line'><span class="sr">  type_name apache</span>
</span><span class='line'><span class="sr">  type elasticsearch</span>
</span><span class='line'><span class="sr">  include_tag_key true</span>
</span><span class='line'><span class="sr">  tag_key @log_name</span>
</span><span class='line'><span class="sr">  host localhost</span>
</span><span class='line'><span class="sr">  port 9200</span>
</span><span class='line'><span class="sr">  logstash_format true</span>
</span><span class='line'><span class="sr">  flush_interval 10s</span>
</span><span class='line'><span class="sr">&lt;/m</span><span class="n">atch</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ td-agent</span></code></pre></td></tr></table></div></figure>


<p>で、td-agentを起動します。</p>

<p>これで準備はできたのですが、トラブル発生。
td-agentでエラーが発生しました。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>2013-12-18 17:05:29 +0900 [error]: config error file="/usr/local/etc/td-agent/td-agent.conf" error="Unknown output plugin 'elasticsearch'. Run 'gem search -rd fluent-plugin' to find plugins"</span></code></pre></td></tr></table></div></figure>


<p>elasticsearchのpluginが見つからないと。。インストールしたはずなのですが。</p>

<p>調べてみると、Fluentdは独自のGEM_HOMEを持っていて、そこにインストールしないとダメらしいです。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ /usr/local/bin/fluent-gem install fluent-plugin-elasticsearch</span></code></pre></td></tr></table></div></figure>


<p>これでtd-agentがpluginを見つけてくれました。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-19T14:18:00+09:00" pubdate data-updated="true">Dec 19<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/12/19/kibana3//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/13/rubymotion-with-storyboard/">
		
			RubyMotionアプリでStoryboardを使うには</a>
	</h2>
	<div class="entry-content">
		<p>RubyMotionアプリでStoryboardを使ったら楽になるかなあ、ていうかそもそもRubyMotionでStoryboardって使えるのかしら、とぼんやり思ったのでggってみたらズバリなページが見つかりました。<br/>
<a href="http://toshikazuhorii.github.io/blog/2012/12/11/storyboard-for-rubymotion/">RubyMotion で Storyboard を使う</a><br/>
非常に丁寧にまとまっています。ありがとうございます。 <br/>
こちらにあるとおり、RubyMotionでもStoryboardはバッチリ使えました。<br/>
楽になるかはまだよく分かりません。。<br/>
とりま、使う手順をまとめてみました。</p>

<h3>やること</h3>

<ol>
<li>XcodeでStoryboardを作成する</li>
<li>StoryboardファイルをコンパイルしてできたディレクトリをRubyMotionアプリのresourcesの下に配置する</li>
<li>AppDelegateのapplicationメソッドの中でStoryboardを読み込み、Storyboard IDとともにrootViewControllerを設定する</li>
</ol>


<h3>1. XcodeでStoryboardを作成する</h3>

<p>ここで作成するときのポイント。</p>

<h4>最初に表示するViewControllerのStoryboard IDに任意値を設定する</h4>

<p>Storyboardを読み込み、rootViewControllerを設定する際に必要になります。</p>

<h4>SegueにIDを設定する</h4>

<p>Segueによる画面遷移をRubyMotionでperformSegueWithIdentifierを使って実装してあげるため、IDが必要になります。</p>

<h3>2. StoryboardファイルをコンパイルしてできたディレクトリをRubyMotionアプリのresourcesの下に配置する</h3>

<p>StoryboardファイルをRubyMotionアプリのresourcesの下へコピーして、</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ ibtool --compile Main.storyboardc Main.storyboard</span></code></pre></td></tr></table></div></figure>


<p>のようにコンパイルすると、Main.storyboardc というようなディレクトリが作成されます。</p>

<h3>3. AppDelegateのapplicationメソッドの中でStoryboardを読み込み、Storyboard IDとともにrootViewControllerを設定する</h3>

<p>UIStoryboardのinstantiateViewControllerWithIdentifierでStoryboard IDを指定します。</p>

<figure class='code'> <div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AppDelegate</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="ss">didFinishLaunchingWithOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">true</span> <span class="k">if</span> <span class="no">RUBYMOTION_ENV</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@storyboard</span> <span class="o">=</span> <span class="no">UIStoryboard</span><span class="o">.</span><span class="n">storyboardWithName</span><span class="p">(</span><span class="s1">&#39;Main&#39;</span><span class="p">,</span>  <span class="ss">bundle</span><span class="p">:</span><span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="vi">@storyboard</span><span class="o">.</span><span class="n">instantiateViewControllerWithIdentifier</span><span class="p">(</span><span class="s1">&#39;TopTab&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span><span class="o">.</span><span class="n">wantsFullScreenLayout</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>    <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>サンプルアプリつくってみました。</h3>

<p><a href="https://github.com/s5ot/MotionWithStoryboard">MotionWithStoryboard</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-13T14:29:00+09:00" pubdate data-updated="true">Dec 13<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/12/13/rubymotion-with-storyboard//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/11/29/bundle-exec-in-bundle-exec/">
		
			Capistranoタスクの中でbundle execする</a>
	</h2>
	<div class="entry-content">
		<p>ローカルのRailsアプリディレクトリでとあるrakeタスクを実行する処理をCapistranoのタスクで実行したかったです。こういう感じです。</p>

<figure class='code'><figcaption><span>Capfile</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:korejikkou</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">run</span> <span class="o">&lt;&lt;-</span><span class="no">CMD</span>
</span><span class='line'><span class="sh">    cd #{toaru_rails_dir}</span>
</span><span class='line'><span class="sh">    bundle exec rake toaru</span>
</span><span class='line'><span class="no">  CMD</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>これを</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>cap
</span></code></pre></td></tr></table></div></figure>


<p>で実行すると、korejikkouの中のbundle execはcapコマンドを実行したディレクトリベースで動いてしまいます。。<br/>
困った。<br/>
こちらにあるように、bundle installには任意のGemfileを指定できるオプションがあるようですが、bundle exec にはないみたいです。<br/>
<a href="http://blog.kyanny.me/entry/2012/04/25/074256">bundle のなかで bundle する</a></p>

<p>が、bundlerではBUNDLE_GEMFILEという環境変数にGemfileの場所がセットされるらしく、これを書き換えると意図してたことができました。</p>

<figure class='code'><figcaption><span>Capfile</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:korejikkou</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">org_gemfile</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;BUNDLE_GEMFILE&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;BUNDLE_GEMFILE&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">toaru_rails_dir</span><span class="si">}</span><span class="s2">/Gemfile&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">run</span> <span class="o">&lt;&lt;-</span><span class="no">CMD</span>
</span><span class='line'><span class="sh">    cd #{toaru_rails_dir}</span>
</span><span class='line'><span class="sh">    bundle exec rake toaru</span>
</span><span class='line'><span class="no">  CMD</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;BUNDLE_GEMFILE&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">org_gemfile</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  （あとで気づいたが、bundle install &#8211;gemfileしてからbundle exec すれば指定したGemfileが使われるんだろう。きっと）</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-11-29T13:58:00+09:00" pubdate data-updated="true">Nov 29<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/11/29/bundle-exec-in-bundle-exec//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/11/25/generator-angular-e2e-test/">
		
			generator-angularでつくったプロジェクトでE2Eテストを実行する</a>
	</h2>
	<div class="entry-content">
		<p>モリモリ盛り上がってるAngularJSのプロジェクトひな形を作ってくれる<a href="https://github.com/yeoman/generator-angular">generator-angular</a> でE2Eテストをするためのメモ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>yo angular
</span></code></pre></td></tr></table></div></figure>


<p>でひな形をつくった時点で、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt <span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure>


<p>でユニットテストをすぐ実行することができる。<br/>
が、E2Eテストを実行するタスクが見当たらない。<br/>
karma-e2e.conf.js というE2Eテスト用のkarmaの設定ファイルはつくられている。</p>

<p>ということで、karma-e2e.conf.jsのこの部分を</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Uncomment the following lines if you are using grunt&#39;s server to run the tests</span>
</span><span class='line'><span class="c1">// proxies: {</span>
</span><span class='line'><span class="c1">//   &#39;/&#39;: &#39;http://localhost:9000/&#39;</span>
</span><span class='line'><span class="c1">// },</span>
</span><span class='line'><span class="c1">// URL root prevent conflicts with the site root</span>
</span><span class='line'><span class="c1">// urlRoot: &#39;_karma_&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>コメントアウトする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Uncomment the following lines if you are using grunt&#39;s server to run the tests</span>
</span><span class='line'><span class="nx">proxies</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="s1">&#39;http://localhost:9000/&#39;</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">// URL root prevent conflicts with the site root</span>
</span><span class='line'><span class="nx">urlRoot</span><span class="o">:</span> <span class="s1">&#39;_karma_&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>testディレクトリ以下にe2eというディレクトリをつくって</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir <span class="nb">test</span>/e2e
</span></code></pre></td></tr></table></div></figure>


<p>この下にE2Eのテストを置く。</p>

<figure class='code'><figcaption><span>test/e2e/sample.js</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;E2E: Testing Routes:&#39;</span><span class="p">,</span>  <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">browser</span><span class="p">().</span><span class="nx">navigateTo</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should display message&#39;</span><span class="p">,</span>  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">element</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;&#39;Allo,  &#39;Allo!&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>そして、おもむろにターミナルでサーバーを起動して。。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grunt serve
</span></code></pre></td></tr></table></div></figure>


<p>さらに別のターミナルでkarmaコマンドを叩けばtest/e2e以下のE2Eテストが実行される。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>karma start karma-e2e.conf.js
</span></code></pre></td></tr></table></div></figure>


<p>どうもE2Eテストのあり方が定まっていないらしく、現在こういう中途半端な状態になっている模様です。<br/>
<a href="https://github.com/yeoman/generator-angular/issues/326">Add an E2E Spec When a View is Created</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-11-25T00:04:00+09:00" pubdate data-updated="true">Nov 25<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/11/25/generator-angular-e2e-test//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/11/05/redmine-google-apps-account-openid/">
		
			Google AppsアカウントでRedmineのOpenID認証</a>
	</h2>
	<div class="entry-content">
		<p>Redmineのバージョンは2.3.3です。</p>

<p>ストレートなOpenID認証ではないのですが、こういうユースケースをRedmineで実現しようとしました。</p>

<ol>
<li>Redmineにユーザーを登録しておく。ユーザーのメールアドレスはGoogle Appsアカウントのメールアドレスにする。</li>
<li>Redmineのログイン画面でGoogle AppsアカウントのメールアドレスをOpenID URLに入力してログインする。入力されたメールアドレスのドメインをもとにしてGoogle AppsアカウントのOpenID認証を行う。</li>
<li>認証できたGoogle Appsアカウントのメールアドレスと同じアドレスを持つユーザーがRedmineにいる場合、Redmineのログイン成功とする。</li>
</ol>


<p>RedmineはもともとOpenID認証の機能を備えており、adminでログインして、管理 - 設定 - 認証からOpenIDによるログインを有効にすることができます。<br/>
しかしこれだけでは上記のようなユースケースを実現できないので、Redmineをカスタマイズしました。こちらに置きました。<br/>
<a href="https://github.com/s5ot/redmine-google-apps-openid">redmine-google-apps-openid</a></p>

<p>こちらが参考になりました。ありがとうございます。<br/>
<a href="http://d.hatena.ne.jp/a_kimura/20100407/1270660711">RailsでGoogle AppsのOpenID対応アプリを作る</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-11-05T15:32:00+09:00" pubdate data-updated="true">Nov 5<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/11/05/redmine-google-apps-account-openid//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/19/remove-gems/">
		
			rvmで入れたgemを削除する</a>
	</h2>
	<div class="entry-content">
		<p>以前はずいぶんrvmのお世話になってましたが、最近の開発環境ではすっかりrbenvを使うようになっています。<br/>
けれどもサーバー環境ではまだrvmを使い続けてたりしてます。<br/>
RubyやRailsのバージョンアップがあったりしてgemがけっこうなディスク容量を食っていたので使ってないgemを削除しようと思い立ちました。<br/>
ちなみにMulti-User Installで入れたrvmなのでコマンドは適当に読み替えてください。</p>

<h3>globalのgemsetを消す</h3>

<p>globalの名前がついたgemsetを消さないと素のgemは消せないようです。 なのでまずglobalを消します。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ rvmsudo rvm gemset delete global</span></code></pre></td></tr></table></div></figure>


<h3>素のgemを削除する</h3>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ rvmsudo gem uninstall -axI `gem list --no-versions`</span></code></pre></td></tr></table></div></figure>


<h3>Rubyを削除する。Rubyだけ削除してもgemは消されないので注意。</h3>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ rvmsudo rvm remove ruby-xxx-pxxx</span></code></pre></td></tr></table></div></figure>


<p>参考にさせてもらったのはこちらです！<br/>
<a href="http://transitive.info/article/ruby/rvm/gemset/">RVM の gemset を使う</a> <br/>
ありがとうございます！</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-19T22:03:00+09:00" pubdate data-updated="true">Aug 19<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/08/19/remove-gems//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/10/copy-xcode-project/">
		
			Xcodeプロジェクトをコピーして新しいプロジェクトをつくる</a>
	</h2>
	<div class="entry-content">
		<p>既存のXcodeプロジェクトをコピーして新しいプロジェクトを作って開発する必要がありました。<br/>
単純にファイルコピーしてもダメなんだろうなーと思ってたらやっぱりダメで、いろいろとやらないといけませんでした。<br/>
環境はXcode4.6.3です。</p>

<p>まず参考にしたのはこちらです。<br/>
<a href="http://hocosoft.com/memo/%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E5%90%8D%E3%81%AE%E5%A4%89%E6%9B%B4/485/">Xcode4.5でiOSアプリのプロジェクト名を変更する方法</a><br/>
ざっとやることは</p>

<ul>
<li>Identity の「Project Name」の項目を書き換える</li>
<li>スキーム名を変更する</li>
<li>グループ名を変更する</li>
<li>プロジェクト名を選択して[Build Settings]から古いプロジェクト名を新しいプロジェクト名に書き換える</li>
</ul>


<p>で、これで基本的に完了な感じですが、自分の場合はARCがらみのエラーがたくさん出てきました。<br/>
これはプロジェクトのコピーではソースコードファイルのCompiler flagsは移行されないことが原因でした。<br/>
元プロジェクトのCompiler flagsの設定を新プロジェクトに設定して解消。</p>

<p>さらにこのあとにplistの警告が出てきました。<br/>
これには下記のとおりCopy Bundle Resoucesからplistをいったん取り除いてから再ビルドで解決しました。<br/>
<a href="http://cheesememo.blog39.fc2.com/blog-entry-564.html">he Copy Bundle Resources build phase contains this target&#8217;s Info.plist file …</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-10T17:40:00+09:00" pubdate data-updated="true">Aug 10<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/08/10/copy-xcode-project//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/03/15/ruby-2-dot-0-0-pitfall/">
		
			Ruby2.0にアップグレードしてつまづいたこと</a>
	</h2>
	<div class="entry-content">
		<p>Ruby 1.9.3 / Rails 3.2.x でアプリを開発しています。</p>

<p>このたびRuby 2.0がめでたくリリースされたのでアップグレードしてみました。</p>

<p>で、ちょいちょいつまづいたことをメモしておきます。</p>

<h3>つまづき：RVM on Mac OS Xでインストールエラー</h3>

<p>まずRuby2.0のインストールにつまづきました。
ビルドでopensslがほにゃららのエラーがでてこけました。</p>

<h3>対策： 下記のとおり。</h3>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ brew update
</span><span class='line'>$ brew install openssl
</span><span class='line'>$ rvm get head
</span><span class='line'>$ rvm install ruby-2.0.0 --skip-openssl --with-opt-dir="`brew --prefix openssl`"</span></code></pre></td></tr></table></div></figure>


<p>(参考）
<a href="https://gist.github.com/jfirebaugh/4007524">Installing Ruby 2.0.0-preview1 with RVM on OS X</a>
　
　
　
　
　
　
　
　
　</p>

<h3>つまづき：iconvがない。</h3>

<p>iconvが標準でついてこなくなりました。</p>

<h3>対策：String#encodeで置き換える。</h3>

<h3>つまづき：respond_to?の仕様が変わった。</h3>

<p>protectedメソッドにrespond_to?するとfalseが返ってくるようになりました。
私はテストがfailしたことがきっかけでこれが分かったのですが、最初はなにが悪いのかわからなくて混乱しました。</p>

<h3>対策：Ruby1.9系と互換を保つにはprotected_to?の第二引数にtrueを指定する。</h3>

<p>true指定でprotected/privateメソッドもrespondableになる。</p>

<p>(参考）
<a href="http://t.co/b410B9IwIv">PROTECTED METHODS AND RUBY 2.0</a></p>

<h3>つまづき: PassengerのApacheモジュールがビルドできない。</h3>

<p>ビルド中にこんなのを吐いて落ちました。</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>cannot load such file -- rubygems/builder</span></code></pre></td></tr></table></div></figure>


<h3>対策：Stableな3.0.19はRuby2.0に対応していないようです。</h3>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>$ gem i passenger --pre</span></code></pre></td></tr></table></div></figure>


<p>で4.0.0 RCのPassegerをインストールしてビルドします。</p>

<p>（参考）
<a href="https://github.com/FooBarWidget/passenger/pull/71">passenger-install-apache2-module doesn&#8217;t work on ruby 2.0</a></p>

<p>あと、この4.0.0 RCのPassegerではRails.rootにconfig.ruがないとRails 1 or Rails 2と見なされて起動しません。
こんなエラーメッセージが出ました。</p>

<blockquote><p>This application is a Rails 3 application,  but it was wrongly detected as a Rails 1 or Rails 2 application.</p>

<p>This is probably a bug in Phusion Passenger,  so please report it</p></blockquote>

<p>なのでconfig.ruをお忘れなく。</p>

<p>（参考）
<a href="https://code.google.com/p/phusion-passenger/issues/detail?id=807">Passenger 3.9.1.beta incorrectly detects Redmine 2.2.1 as Rails 1/2 app</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-15T14:39:00+09:00" pubdate data-updated="true">Mar 15<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/03/15/ruby-2-dot-0-0-pitfall//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/24/kindle-paperwhite-cant-wifi/">
		
			Kindle PaperwhiteがWiFiに接続できないとき</a>
	</h2>
	<div class="entry-content">
		<p>Kindle Paperwhiteを去年11月に購入して使っていたのですが、最近になって充電してください表示から画面が動かなくなってしまいました。
Amazonサポートに連絡すると、すぐに新しいものを送りますとのことで、2日後には新しいKindle Paperwhiteが届きました。</p>

<p>さっそくセットアップしていると、WiFiに接続できないエラーが。
これは1台目のときも同じことがありました。なのでメモしておきます。
（ちなみに自宅ではAppleのTimeCapsuleを無線ルーターに使っています）</p>

<p>WiFiネットワークの詳細を選んで、手動で設定します。
接続タイプに「スタティック」を選択します。
該当のWiFiネットワークに接続できているPCやスマホのネットワーク設定を参考にして</p>

<ul>
<li>IPアドレス</li>
<li>サブネットマスク</li>
<li>ルータ</li>
<li>DNS</li>
</ul>


<p>の設定をそれぞれ入力します。
IPアドレスは他の機器とかぶらないようにします。（192.168.1.xのxを9とかにして）</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-02-24T16:59:00+09:00" pubdate data-updated="true">Feb 24<span>th</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/blog/2013/02/24/kindle-paperwhite-cant-wifi//index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
  <footer id="footer" class="inner">Copyright &copy; 2013

    s5ot

</footer>
  <script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 's5ot';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-37441932-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
